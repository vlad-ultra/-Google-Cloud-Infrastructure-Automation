name: ðŸ§ª Test GitHub Secrets

on:
  workflow_dispatch: # Manual trigger only

env:
  GCP_PROJECT_ID: ${{ secrets.GCP_PROJECT_ID }}
  GCP_SA_KEY: ${{ secrets.GCP_SA_KEY }}

jobs:
  test-secrets:
    runs-on: ubuntu-latest
    
    steps:
    - name: ðŸ“¥ Checkout code
      uses: actions/checkout@v4

    - name: ðŸ” Setup Google Cloud CLI
      uses: google-github-actions/setup-gcloud@v2
      with:
        service_account_key: ${{ secrets.GCP_SA_KEY }}
        project_id: ${{ secrets.GCP_PROJECT_ID }}
        export_default_credentials: true

    - name: ðŸ§ª Test Authentication
      run: |
        echo "ðŸ” Testing Google Cloud authentication..."
        echo "Current account: $(gcloud auth list --filter=status:ACTIVE --format='value(account)')"
        echo "Project: $(gcloud config get-value project)"
        echo "Available services:"
        gcloud services list --enabled --limit=5
        echo "âœ… Authentication test completed!"

    - name: ðŸ“Š Test Summary
      run: |
        echo "## ðŸ§ª Secrets Test Results" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### âœ… Authentication:" >> $GITHUB_STEP_SUMMARY
        echo "- Account: $(gcloud auth list --filter=status:ACTIVE --format='value(account)')" >> $GITHUB_STEP_SUMMARY
        echo "- Project: $(gcloud config get-value project)" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸ”‘ Secrets Status:" >> $GITHUB_STEP_SUMMARY
        if [ -n "$GCP_PROJECT_ID" ]; then
          echo "- âœ… GCP_PROJECT_ID: Set" >> $GITHUB_STEP_SUMMARY
        else
          echo "- âŒ GCP_PROJECT_ID: Not set" >> $GITHUB_STEP_SUMMARY
        fi
        if [ -n "$GCP_SA_KEY" ]; then
          echo "- âœ… GCP_SA_KEY: Set" >> $GITHUB_STEP_SUMMARY
        else
          echo "- âŒ GCP_SA_KEY: Not set" >> $GITHUB_STEP_SUMMARY
        fi
